var e=function(){return(e=Object.assign||function(e){for(var t,o=1,n=arguments.length;o<n;o++)for(var i in t=arguments[o])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};var t=["autoPlay","allowMutedAutoPlay","timeout"],o=["reply-set-play","reply-get-duration","reply-get-current-time","reply-get-muted","reply-get-presentation-mode"],n=["can-play","pause","play","ended","time-update","volume-change","presentation-mode-changed","error"],i={autoPlay:!1,allowMutedAutoPlay:!1,controls:!0},r=function(e){var t={};return e.forEach((function(e){t[e]=[]})),t};function s(e,t){return new Promise((function(o){e.iframePostMessage("get-"+t);var n=setTimeout((function(){o(void 0)}),200);e.waitQueueMap["reply-get-"+t].push((function(e){o(e),clearTimeout(n)}))}))}var a=function(){function a(t){var s=this;this.config=e(e({},i),t),this.$iframe=t.target,this.waitQueueMap=r(o),this.eventHandlerMap=r(n),this.timers={},this.beforePostHooks=[],this.onMessageHandler=function(e){!function(e,t){var o=t.data;if(function(e){return o=typeof(t=e),null!=t&&("object"==o||"function"==o)&&"eventType"in e;var t,o}(o)){var n=o.eventType;e.consumer(n,o.value),e.trigger(n,o.value)}}(s,e)},window.addEventListener("message",this.onMessageHandler);var a,u,f,p,l,c,y,d=!0;this.on("can-play",(function(){d&&(d=!1,s.config.autoPlay&&s.setPlay().then((function(e){e.resolved||s.config.allowMutedAutoPlay&&(s.setMuted({muted:!0}),s.setPlay())})))})),!1===this.config.controls&&(this.config.playUrl=(a=t.playUrl,u=a.split("#"),f=u[0],p=u[1],l=f.split("?"),c=l[0],(null==(y=l[1])?void 0:y.length)?a.replace(y,y+"&controls=0"):c+"?controls=0"+(p?"#"+p:"")));var h=this.config.timeout;if("number"==typeof h&&h>0){var g=setTimeout((function(){s.trigger("error",{message:"timeout",code:0})}),h);this.timers[g]=g,this.on("can-play",(function(){clearTimeout(g),delete s.timers[g]}))}this.$iframe.src=this.config.playUrl}return a.prototype.beforePostMessage=function(e){this.beforePostHooks.push(e)},a.prototype.iframePostMessage=function(e,t){var o=this,n=function(e,t,i){var r;if(i!==o.beforePostHooks.length){var s=o.beforePostHooks[i];null==s||s(e,t,(function(t){n(e,t,i+1)}))}else null===(r=o.$iframe.contentWindow)||void 0===r||r.postMessage({eventType:e,value:t},o.config.playUrl)};n(e,t,0)},a.prototype.setPlay=function(){var e=this;return new Promise((function(t){e.iframePostMessage("set-play"),e.iframePostMessage("play-video");var o=setTimeout((function(){t({resolved:!1})}),200);e.waitQueueMap["reply-set-play"].push((function(e){t(e),clearTimeout(o)}))}))},a.prototype.setPause=function(){this.iframePostMessage("set-pause"),this.iframePostMessage("pause-video")},a.prototype.setMuted=function(e){this.iframePostMessage("set-muted",e)},a.prototype.setPresentationMode=function(e){this.iframePostMessage("set-presentation-mode",e)},a.prototype.getDuration=function(){return s(this,"duration")},a.prototype.getCurrentTime=function(){return s(this,"current-time")},a.prototype.getMuted=function(){return s(this,"muted")},a.prototype.getPresentationMode=function(){return s(this,"presentation-mode")},a.prototype.consumer=function(e,t){if(o.indexOf(e)>=0){var n=this.waitQueueMap[e].shift();n&&n(t)}},a.prototype.on=function(e,t){this.eventHandlerMap[e].push(t)},a.prototype.off=function(e,t){var o=this.eventHandlerMap;if(t){var n=o[e].indexOf(t);if(n<0)return;o[e].splice(n,1)}else o[e]=[]},a.prototype.trigger=function(e,t){n.indexOf(e)>=0&&this.eventHandlerMap[e].forEach((function(e){e(t)}))},a.prototype.setConfig=function(e){for(var o in e)t.indexOf(o)>=0&&(this.config[o]=e[o])},a.prototype.destroy=function(){for(var e in window.removeEventListener("message",this.onMessageHandler),this.timers)clearTimeout(e)},a}();export{a as default};
